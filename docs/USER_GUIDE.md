# Life Plan Simulator ユーザーガイド

ブラウザのみで動作する家計シミュレーションアプリです。複数のシナリオを作成し、住人の収入・支出・住宅・車・貯蓄条件を入力すると、年間キャッシュフローと累積資産を比較できます。

## 使い方

1. `npm run dev` で開発サーバーを起動し、 [http://localhost:5173](http://localhost:5173) を開きます。
2. 左側の「シナリオ一覧」でベースとなるシナリオを選択、複製、または新規追加します。
3. 「条件の編集」で以下を入力すると右側のグラフと表が即時更新されます。
   - 住人 (住人情報 / 収入イベント / 教育・習い事の支出)
   - 住宅 (ローン・管理費・修繕費・築年数)
   - 車 (ローン / 車検 / 点検 / 駐車場 / 維持費)
   - 生活費 (生活費 / 光熱費 / 保険 / 医療 / 物価上昇率)
   - 貯蓄 (預金と投資を別々に管理し、利率や積立額を設定)
   - 世帯イベント支出 (世帯全体にかかる習い事や大学費用、リフォーム等)
4. 右側では次の情報を確認できます。
   - 累積資産（折れ線）: 各シナリオの純資産推移
   - 年間キャッシュフロー（棒グラフ）
   - 比較サマリー表 (総収入 / 総支出 / 最終純資産 / 赤字開始年)
   - 「赤字なし」または「◯年に赤字」の警告
5. JSON書き出し/読込ボタンでシナリオをバックアップしたり、本番データをインポートできます。  
   「共有リンク」を押すと現在のシナリオセットを Base64 でエンコードした URL をクリップボードへコピーできます。

## 用語対応

| 日本語 | 英語 UI | 説明 |
| --- | --- | --- |
| 住人 | Resident | 家計を構成する人。年齢・退職年齢・手取り収入・上昇率・イベントを設定。 |
| 収入イベント | Income Events | 昇給・減収・退職金など、特定年齢で収入を増減する要素。 |
| 習い事 | Lessons | 住人または世帯に対する年間支出バンド。教育カテゴリーとして扱います。 |
| 住宅ローン | Mortgage | ローン残額・月々の支払・管理費・修繕費を入力。 |
| 車検 | Vehicle Inspection | `inspectionCycleYears` と `inspectionCost` で周期的な費用を管理。 |
| 貯蓄 | Savings | 預金（deposit）と投資（investment）を分けて利率・積立額を設定。 |

## JSON フォーマット

- ルートは `Scenario[]`。旧形式（`{ "scenarios": [...] }`）も自動で読み替えます。
- 住人（`Resident`）は `incomeEvents` と `expenseBands` を持ちます。`expenseBands` の `category` により教育/住宅/車/生活/習い事/その他に分類されます。
- シナリオ全体の `expenseBands` は開始年オフセット (`startAge`) で期間指定します。0 はシミュレーション開始年を指します。
- `savingsAccounts` では `type: 'deposit' | 'investment'`、`annualInterestRate` (e.g., 0.03) を指定します。
- 共有リンク生成時はシナリオ配列を Base64 (UTF-8) にエンコードして `?snapshot=` パラメータへ付与します。

## トラブルシューティング

- **残高が常にマイナスになる:** 生活費や支出バンドを見直し、貯蓄引き出し優先度（`withdrawPriority`）を調整してください。
- **フォームが反応しない:** ブラウザのローカルストレージが壊れている場合はデベロッパーツールから `localStorage.clear()` を実行、あるいは「サンプル」ボタンで初期シナリオを再読込します。
- **JSONインポート失敗:** ファイルが `Scenario[]` 形式か確認し、`id` が重複する場合は削除・更新してください。
